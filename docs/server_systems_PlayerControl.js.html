<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: server/systems/PlayerControl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: server/systems/PlayerControl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const System = require('../../shared/systems/System');
const MessageTypes = require('../../shared/MessageTypes');

/**
 * @type {PlayerControl}
 * @extends {System}
 */
class PlayerControl extends System {
  /**
   * constructor
   */
  constructor({engine}) {
    super(['playercontrol', 'position', 'physics']);

    this.inputs = {};
  }

  /**
   * Set server input state for a player.
   * @param {Number} id Id of player
   * @param {Object} data Key state delta.
   */
  setInput(id, data) {
    let input = this.inputs[id];
    if(!input) {
      this.inputs[id] = {
        keys: data.keys || {},
        gamepad: data.gamepad || {},
      };
    } else {
      if(data.keys) {
        input.keys = Object.assign(input.keys, data.keys);
      }
      if(data.gamepad) {
        input.gamepad = Object.assign(input.gamepad, data.gamepad);
      }
    }
  }

  /**
   * Run the system on the entities.
   * @param {Array} entities
   */
  update(entities) {
    let entity;
    let netId;
    let acc;
    let i = 0;
    let input;

    for(; i &lt; entities.length; i++) {
      entity = entities[i];
      netId = entity.networksync.netId;
      input = this.inputs[netId];
      acc = entity.physics.acc;


      if(input) {
        if(input.keys) {
          if(input.keys.a){
            acc.x -=1;
          }
          if(input.keys.d) {
            acc.x +=1;
          }
          if(input.keys.w) {
            acc.y -=1;
          }
          if(input.keys.s) {
            acc.y +=1;
          }
        }

        if(input.gamepad &amp;&amp; input.gamepad[1]){
          acc.x += input.gamepad[1].axis_0 || 0;
          acc.y += input.gamepad[1].axis_1 || 0;
        }
      }
    }
  }

}

module.exports = PlayerControl;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Appearance.html">Appearance</a></li><li><a href="CircularBuffer.html">CircularBuffer</a></li><li><a href="Client.html">Client</a></li><li><a href="Component.html">Component</a></li><li><a href="DebugRender.html">DebugRender</a></li><li><a href="Engine.html">Engine</a></li><li><a href="Entity.html">Entity</a></li><li><a href="GamePadManager.html">GamePadManager</a></li><li><a href="Health.html">Health</a></li><li><a href="Keys.html">Keys</a></li><li><a href="module.exports.html">exports</a></li><li><a href="NetworkSync.html">NetworkSync</a></li><li><a href="Physics.html">Physics</a></li><li><a href="PlayerControl.html">PlayerControl</a></li><li><a href="Position.html">Position</a></li><li><a href="System.html">System</a></li><li><a href="Vector.html">Vector</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Sun Sep 03 2017 11:27:39 GMT-0500 (CDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
